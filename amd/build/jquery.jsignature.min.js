define(["jquery"],function(g){function h(t,n){var e;return this.kick=function(){clearTimeout(e),e=setTimeout(n,t)},this.clear=function(){clearTimeout(e)},this}function l(t){"use strict";this.topics={},this.context=t||this,this.publish=function(t,n,e,i){if(this.topics[t]){for(var o,r,s=this.topics[t],a=Array.prototype.slice.call(arguments,1),h=[],u=[],c=0,l=s.length;c<l;c++)o=(r=s[c])[0],r[1]&&(r[0]=function(){},h.push(c)),u.push(o);for(c=0,l=h.length;c<l;c++)s.splice(h[c],1);for(c=0,l=u.length;c<l;c++)u[c].apply(this.context,a)}},this.subscribe=function(t,n,e){return this.topics[t]?this.topics[t].push([n,e]):this.topics[t]=[[n,e]],{topic:t,callback:n}},this.unsubscribe=function(t){if(this.topics[t.topic])for(var n=this.topics[t.topic],e=0,i=n.length;e<i;e++)n[e]&&n[e][0]===t.callback&&n.splice(e,1)}}function u(t,n){this.x=t,this.y=n,this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)},this._length=null,this.getLength=function(){return this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))),this._length};function i(t){return Math.round(t/Math.abs(t))}this.resizeTo=function(t){var n,e;return 0===this.x&&0===this.y?this._length=0:0===this.x?(this._length=t,this.y=t*i(this.y)):0===this.y?(this._length=t,this.x=t*i(this.x)):(e=(e=Math.abs(this.y/this.x))*(n=Math.sqrt(Math.pow(t,2)/(1+Math.pow(e,2)))),this._length=t,this.x=n*i(this.x),this.y=e*i(this.y)),this},this.angleTo=function(t){var n=this.getLength()*t.getLength();return 0==n?0:Math.acos(Math.min(Math.max((this.x*t.x+this.y*t.y)/n,-1),1))/Math.PI}}function c(t,n){this.x=t,this.y=n,this.getVectorToCoordinates=function(t,n){return new u(t-this.x,n-this.y)},this.getVectorFromCoordinates=function(t,n){return this.getVectorToCoordinates(t,n).reverse()},this.getVectorToPoint=function(t){return new u(t.x-this.x,t.y-this.y)},this.getVectorFromPoint=function(t){return this.getVectorToPoint(t).reverse()}}function d(t,n,e,i,o){if(this.data=t,this.context=n,t.length)for(var r,s,a=t.length,h=0;h<a;h++){s=(r=t[h]).x.length,e.call(n,r);for(var u=1;u<s;u++)i.call(n,r,u);o.call(n,r)}this.changed=function(){},this.startStrokeFn=e,this.addToStrokeFn=i,this.endStrokeFn=o,this.inStroke=!1,this._lastPoint=null,this._stroke=null,this.startStroke=function(t){if(t&&"number"==typeof t.x&&"number"==typeof t.y){this._stroke={x:[t.x],y:[t.y]},this.data.push(this._stroke),this._lastPoint=t,this.inStroke=!0;var n=this._stroke,e=this.startStrokeFn,i=this.context;return setTimeout(function(){e.call(i,n)},3),t}return null},this.addToStroke=function(t){if(this.inStroke&&"number"==typeof t.x&&"number"==typeof t.y&&4<Math.abs(t.x-this._lastPoint.x)+Math.abs(t.y-this._lastPoint.y)){var n=this._stroke.x.length;this._stroke.x.push(t.x),this._stroke.y.push(t.y),this._lastPoint=t;var e=this._stroke,i=this.addToStrokeFn,o=this.context;return setTimeout(function(){i.call(o,e,n)},3),t}return null},this.endStroke=function(){var t=this.inStroke;if(this.inStroke=!1,this._lastPoint=null,t){var n=this._stroke,e=this.endStrokeFn,i=this.context,o=this.changed;return setTimeout(function(){e.call(i,n),o.call(i)},3),!0}return null}}function p(t,n,e,i,o){t.beginPath(),t.moveTo(n,e),t.lineTo(i,o),t.closePath(),t.stroke()}function f(t,n,e,i,o,r,s,a,h){t.beginPath(),t.moveTo(n,e),t.bezierCurveTo(r,s,a,h,i,o),t.closePath(),t.stroke()}function v(t){var n,e,i,o;n=this.canvasContext,e=t.x[0],i=t.y[0],o=this.settings.lineWidth,t=n.fillStyle,n.fillStyle=n.strokeStyle,n.fillRect(e+o/-2,i+o/-2,o,o),n.fillStyle=t}function y(t,n){var e,i,o,r,s=new c(t.x[n-1],t.y[n-1]),a=new c(t.x[n],t.y[n]),h=s.getVectorToPoint(a);1<n&&((i=(e=new c(t.x[n-2],t.y[n-2])).getVectorToPoint(s)).getLength()>this.lineCurveThreshold&&(o=2<n?new c(t.x[n-3],t.y[n-3]).getVectorToPoint(e):new u(0,0),r=.35*i.getLength(),t=i.angleTo(o.reverse()),n=h.angleTo(i.reverse()),t=new u(o.x+i.x,o.y+i.y).resizeTo(Math.max(.05,t)*r),r=new u(i.x+h.x,i.y+h.y).reverse().resizeTo(Math.max(.05,n)*r),f(this.canvasContext,e.x,e.y,s.x,s.y,e.x+t.x,e.y+t.y,s.x+r.x,s.y+r.y))),h.getLength()<=this.lineCurveThreshold&&p(this.canvasContext,s.x,s.y,a.x,a.y)}function x(t){var n,e,i,o=t.x.length-1;0<o&&(n=new c(t.x[o],t.y[o]),(i=(e=new c(t.x[o-1],t.y[o-1])).getVectorToPoint(n)).getLength()>this.lineCurveThreshold&&(1<o?(i=new u((o=new c(t.x[o-2],t.y[o-2]).getVectorToPoint(e)).x+i.x,o.y+i.y).resizeTo(i.getLength()/2),f(this.canvasContext,e.x,e.y,n.x,n.y,e.x+i.x,e.y+i.y,n.x,n.y)):p(this.canvasContext,e.x,e.y,n.x,n.y)))}function m(t,n,e){var i,o=this.$parent=g(t),r=this.eventTokens={},s=(this.events=new l(this),g.fn[w]("globalEvents")),a={width:"ratio",height:"ratio",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:!1,readOnly:!1,data:[],signatureLine:!1};for(i in g.extend(a,function(t){for(var n,e,i=t.css("color"),o=t[0],r=!1;o&&!e&&!r;){try{h=g(o).css("background-color")}catch(t){h="transparent"}"transparent"!==h&&"rgba(0, 0, 0, 0)"!==h&&(e=h),r=o.body,o=o.parentNode}var s,a=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,t=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,h=n;(h=i.match(a))?l={r:parseInt(h[1],10),g:parseInt(h[2],10),b:parseInt(h[3],10)}:(h=i.match(t))&&(l={r:parseInt(h[1],16),g:parseInt(h[2],16),b:parseInt(h[3],16)}),e?(h=n,(h=e.match(a))?s={r:parseInt(h[1],10),g:parseInt(h[2],10),b:parseInt(h[3],10)}:(h=e.match(t))&&(s={r:parseInt(h[1],16),g:parseInt(h[2],16),b:parseInt(h[3],16)})):s=l&&127<Math.max.apply(null,[l.r,l.g,l.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255};var u,c,l,t=function(t){return"rgb("+[t.r,t.g,t.b].join(", ")+")"};return c=l&&s?(c=Math.max.apply(null,[l.r,l.g,l.b]),u=Math.max.apply(null,[s.r,s.g,s.b]),{r:c=Math.round(u+-1*(u-c)*.75),g:c,b:c}):l?(l=127<(u=Math.max.apply(null,[l.r,l.g,l.b]))?-1:1,{r:c=Math.round(u+96*l),g:c,b:c}):{r:191,g:191,b:191},{color:i,"background-color":s?t(s):e,"decor-color":t(c)}}(o)),n&&g.extend(a,n),this.settings=a,e)e.hasOwnProperty(i)&&e[i].call(this,i);this.events.publish(w+".initializing"),this.$controlbarUpper=g('<div style="padding:0 !important; margin:0 !important;width: 100% !important; height: 0 !important; -ms-touch-action: none; touch-action: none;margin-top:-1em !important; margin-bottom:1em !important;"></div>').appendTo(o),this.isCanvasEmulator=!1;t=this.canvas=this.initializeCanvas(a),n=g(t);this.$controlbarLower=g('<div style="padding:0 !important; margin:0 !important;width: 100% !important; height: 0 !important; -ms-touch-action: none; touch-action: none;margin-top:-1.5em !important; margin-bottom:1.5em !important; position: relative;"></div>').prependTo(o),this.canvasContext=t.getContext("2d"),n.data(w+".this",this),a.lineWidth=(o=a.lineWidth,t=t.width,o||Math.max(Math.round(t/400),2)),this.lineCurveThreshold=3*a.lineWidth,a.cssclass&&""!=g.trim(a.cssclass)&&n.addClass(a.cssclass),this.fatFingerCompensation=0;n=function(e){function i(t){return t=t.changedTouches&&0<t.changedTouches.length?t.changedTouches[0]:t,new c(Math.round(t.pageX+o),Math.round(t.pageY+r)+e.fatFingerCompensation)}var o,r,s=new h(750,function(){e.dataEngine.endStroke()});return this.drawEndHandler=function(t){if(!e.settings.readOnly){try{t.preventDefault()}catch(t){}s.clear(),e.dataEngine.endStroke()}},this.drawStartHandler=function(t){var n;e.settings.readOnly||(t.preventDefault(),n=g(e.canvas).offset(),o=-1*n.left,r=-1*n.top,e.dataEngine.startStroke(i(t)),s.kick())},this.drawMoveHandler=function(t){e.settings.readOnly||(t.preventDefault(),e.dataEngine.inStroke&&(e.dataEngine.addToStroke(i(t)),s.kick()))},this}.call({},this);return function(n,e,i){var o,r=this.canvas,t=g(r);this.isCanvasEmulator?(t.bind("mousemove."+w,i),t.bind("mouseup."+w,n),t.bind("mousedown."+w,e)):(o="function"==typeof r.addEventListener,this.ontouchstart=function(t){r.onmousedown=r.onmouseup=r.onmousemove=void 0,this.fatFingerCompensation=a.minFatFingerCompensation&&-3*a.lineWidth>a.minFatFingerCompensation?-3*a.lineWidth:a.minFatFingerCompensation,e(t),o?(r.addEventListener("touchend",n),r.addEventListener("touchstart",e),r.addEventListener("touchmove",i)):(r.ontouchend=n,r.ontouchstart=e,r.ontouchmove=i)},o?r.addEventListener("touchstart",this.ontouchstart):r.ontouchstart=ontouchstart,r.onmousedown=function(t){o?r.removeEventListener("touchstart",this.ontouchstart):r.ontouchstart=r.ontouchend=r.ontouchmove=void 0,e(t),r.onmousedown=e,r.onmouseup=n,r.onmousemove=i},window.navigator.msPointerEnabled&&(r.onmspointerdown=e,r.onmspointerup=n,r.onmspointermove=i))}.call(this,n.drawEndHandler,n.drawStartHandler,n.drawMoveHandler),r[w+".windowmouseup"]=s.subscribe(w+".windowmouseup",n.drawEndHandler),this.events.publish(w+".attachingEventHandlers"),function(i,t,o,r){"use strict";var s,a,h;"ratio"!==t&&"%"!==t.split("")[t.length-1]||(this.eventTokens[o+".parentresized"]=r.subscribe(o+".parentresized",(s=this.eventTokens,a=this.$parent,h=this.$parent.width(),this.canvas.width,this.canvas.height,function(){var t=a.width();if(t!==h){for(var n in s)s.hasOwnProperty(n)&&(r.unsubscribe(s[n]),delete s[n]);var e=i.settings;for(n in i.$parent.children().remove(),i)i.hasOwnProperty(n)&&delete i[n];e.data=function(t,n){for(var e,i,o,r,s=[],a=0,h=t.length;a<h;a++){for(e={x:[],y:[]},i=0,o=(r=t[a]).x.length;i<o;i++)e.x.push(r.x[i]*n),e.y.push(r.y[i]*n);s.push(e)}return s}(e.data,+t/h),a[o](e)}})))}.call(this,this,a.width.toString(10),w,s),this.resetCanvas(a.data),this.events.publish(w+".initialized"),this}var w;function t(n){var e="jSignature";this.events.subscribe(e+".attachingEventHandlers",function(){var t;this.settings[n]&&("function"!=typeof(t=this.settings[n])&&(t=function(){return $undoButton=g('<input type="button" style="position:absolute;display:none;margin:0 !important;top:auto; width:32px; height:32px; background-position:center; background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABYElEQVRYR+3VzSpFYRTG8Z/CQJEBJjJSyAWYM2Xke2hu7ALMTeRjLiOlGLkBpchEKXEHJiQZilZt2nZ7ny/bOQZnzXZnvet9nv9a67wdWhwdLb5fW0CbwG8IDGEHK78Z5EYFrGIX/ehspoBwvY+F5NL3ZgoI1OF6IOW4KQKyrtPE/1zAMvYyrrMtf8MjHnCJM1zVOhdFQziY9Hqx1kKZvFts4rja+TwBtbiuVvfr91Os4aXoQJ6ApQR7UCgjbjCDp7xilVoQvQ8xZcQ5phFD+yOq/RGVSWMDW/UKiPxoRSUa3YhVnUxcxgyN5mB7xghia76jGoF0bhGNbI34nk3cjmeExEAeNCqgiEaRiR4cYj514RHiHWmIQBGNShTjoTrBXHL4HhNlCEjTiJ5Xil5cYwyv6CtLQD3rOYULfKCrFQLizm2sZ5/veragHsd5uYH+DsOtIpBroJkE2gLaBP4ngU+LCzAhIdk/3wAAAABJRU5ErkJggg==);" />').appendTo(this.$controlbarLower),$undoButton}),function(t,n,e){var i,o,r,s,t=t.call(this);o=t,(i=this).events.subscribe(n+".change",function(){i.dataEngine.data.length?o.show():o.hide()}),t=t,n=(r=this).events.topics.hasOwnProperty(n+".undo")?e:n,s=n+".undo",t.bind("click",function(){r.events.publish(s)}),r.events.subscribe(s,function(){var t=r.dataEngine.data;t.length&&(t.pop(),r.resetCanvas(t))})}.call(this,t,e,n))})}w="jSignature",m.prototype.resetCanvas=function(t,n){var e=this.canvas,i=this.settings,o=this.canvasContext,r=this.isCanvasEmulator,s=e.width,a=e.height;n||o.clearRect(0,0,s+30,a+30),o.shadowColor=o.fillStyle=i["background-color"],r&&o.fillRect(0,0,s+30,a+30),o.lineWidth=Math.ceil(parseInt(i.lineWidth,10)),o.lineCap=o.lineJoin="round",i.signatureLine&&(null!=i["decor-color"]&&(o.strokeStyle=i["decor-color"],o.shadowOffsetX=0,o.shadowOffsetY=0,n=Math.round(a/5),p(o,1.5*n,a-n,s-1.5*n,a-n)),r||(o.shadowColor=o.strokeStyle,o.shadowOffsetX=.5*o.lineWidth,o.shadowOffsetY=-.6*o.lineWidth,o.shadowBlur=0)),o.strokeStyle=i.color,t=t||[];o=this.dataEngine=new d(t,this,v,y,x);return i.data=t,g(e).data(w+".data",t).data(w+".settings",i),o.changed=function(t,n){"use strict";return function(){n.publish("jSignature.change"),t.trigger("change")}}(this.$parent,this.events),o.changed(),!0},m.prototype.initializeCanvas=function(t){var n=document.createElement("canvas"),e=g(n);return t.width===t.height&&"ratio"===t.height&&(t.width="100%"),e.css({margin:0,padding:0,border:"none",height:"ratio"!==t.height&&t.height?t.height.toString(10):1,width:"ratio"!==t.width&&t.width?t.width.toString(10):1,"-ms-touch-action":"none","touch-action":"none","background-color":t["background-color"]}),e.appendTo(this.$parent),"ratio"===t.height?e.css("height",Math.round(e.width()/t.sizeRatio)):"ratio"===t.width&&e.css("width",Math.round(e.height()*t.sizeRatio)),e.addClass(w),n.width=e.width(),n.height=e.height(),this.isCanvasEmulator=function(t){if(t.getContext)return!1;var n=t.ownerDocument.parentWindow,e=n.FlashCanvas?t.ownerDocument.parentWindow.FlashCanvas:"undefined"==typeof FlashCanvas?void 0:FlashCanvas;if(e){t=e.initElement(t);var i=1;if(n&&n.screen&&n.screen.deviceXDPI&&n.screen.logicalXDPI&&(i=+n.screen.deviceXDPI/n.screen.logicalXDPI),1!==i)try{g(t).children("object").get(0).resize(Math.ceil(t.width*i),Math.ceil(t.height*i)),t.getContext("2d").scale(i,i)}catch(t){}return!0}throw new Error("Canvas element does not support 2d context. jSignature cannot proceed.")}(n),n.onselectstart=function(t){return t&&t.preventDefault&&t.preventDefault(),t&&t.stopPropagation&&t.stopPropagation(),!1},n},function(o){var e=new l;!function(n,e){"use strict";function t(){n.publish(e+".parentresized")}var i;g(o).bind("resize."+e,function(){i&&clearTimeout(i),i=setTimeout(t,500)}).bind("mouseup."+e,function(t){n.publish(e+".windowmouseup")})}(e,w);var n={},i={default:function(t){return this.toDataURL()},native:function(t){return t},image:function(t){var n=this.toDataURL();if("string"==typeof n&&4<n.length&&"data:"===n.slice(0,5)&&-1!==n.indexOf(",")){var e=n.indexOf(",");return[n.slice(5,e),n.substr(e+1)]}return[]}};function t(t,n,e){"use strict";var i=new Image,o=this;i.onload=function(){var t=o.getContext("2d"),n=t.shadowColor;t.shadowColor="transparent",t.drawImage(i,0,0,(i.width<o.width?i:o).width,(i.height<o.height?i:o).height),t.shadowColor=n},i.src="data:"+n+","+t}var r={native:function(t,n,e){e(t)},image:t,"image/png;base64":t,"image/jpeg;base64":t,"image/jpg;base64":t};function s(t,n){return this.find("canvas."+w).add(this.filter("canvas."+w)).data(w+".this").resetCanvas(t,n),this}function a(t,n){if(void 0!==n||"string"!=typeof t||"data:"!==t.substr(0,5)||(n=t.slice(5).split(",")[0])!==(t=t.slice(6+n.length))){var e,i=this.find("canvas."+w).add(this.filter("canvas."+w));if(!r.hasOwnProperty(n))throw new Error(w+" is unable to find import plugin with for format '"+String(n)+"'");return 0!==i.length&&r[n].call(i[0],t,n,(e=i.data(w+".this"),function(){return e.resetCanvas.apply(e,arguments)})),this}}function h(t){var n=!1;for(t=t.parentNode;t&&!n;)n=t.body,t=t.parentNode;return!n}var u={export:i,import:r,instance:n},c={init:function(t){return this.each(function(){h(this)||new m(this,t,n)})},destroy:function(){return this.each(function(){if(!h(this)){var t=g(this).find("canvas").data(w+".this");if(t)for(var n in t.$controlbarLower.remove(),t.$controlbarUpper.remove(),g(t.canvas).remove(),t.eventTokens)t.eventTokens.hasOwnProperty(n)&&e.unsubscribe(t.eventTokens[n])}})},getSettings:function(){return this.find("canvas."+w).add(this.filter("canvas."+w)).data(w+".this").settings},isModified:function(){return null!==this.find("canvas."+w).add(this.filter("canvas."+w)).data(w+".this").dataEngine._stroke},updateSetting:function(t,n,e){var i=this.find("canvas."+w).add(this.filter("canvas."+w)).data(w+".this");return i.settings[t]=n,i.resetCanvas(e?null:i.settings.data,!0),i.settings[t]},clear:s,reset:s,addPlugin:function(t,n,e){return u.hasOwnProperty(t)&&(u[t][n]=e),this},listPlugins:function(t){var n=[];if(u.hasOwnProperty(t)){var e,i=u[t];for(e in i)i.hasOwnProperty(e)&&n.push(e)}return n},getData:function(t){var n=this.find("canvas."+w).add(this.filter("canvas."+w));if(void 0===t&&(t="default"),0!==n.length&&i.hasOwnProperty(t))return i[t].call(n.get(0),n.data(w+".data"),n.data(w+".settings"))},importData:a,setData:a,globalEvents:function(){return e},disable:function(){this.find("input").attr("disabled",1),this.find("canvas."+w).addClass("disabled").data(w+".this").settings.readOnly=!0},enable:function(){this.find("input").removeAttr("disabled"),this.find("canvas."+w).removeClass("disabled").data(w+".this").settings.readOnly=!1},events:function(){return this.find("canvas."+w).add(this.filter("canvas."+w)).data(w+".this").events}};g.fn[w]=function(t){"use strict";return t&&"object"!=typeof t?"string"==typeof t&&c[t]?c[t].apply(this,Array.prototype.slice.call(arguments,1)):void g.error("Method "+String(t)+" does not exist on jQuery."+w):c.init.apply(this,arguments)}}(window),function(){for(var c={},l={},t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split(""),d=t.length/2,n=d-1;-1<n;n--)c[t[n]]=t[n+d],l[t[n+d]]=t[n];function r(t){for(var n,e,i=[],o=0,r=1,s=t.length,a=0;a<s;a++)e=(n=Math.round(t[a]))-o,o=n,e<0&&0<r?(r=-1,i.push("Z")):0<e&&r<0&&(r=1,i.push("Y")),e=Math.abs(e),d<=e?i.push(function(t){for(var n=t.split(""),e=n.length,i=1;i<e;i++)n[i]=c[n[i]];return n.join("")}(e.toString(d))):i.push(e.toString(d));return i.join("")}function s(t){for(var n,e,i=[],o=t.split(""),r=o.length,s=1,a=[],h=0,u=0;u<r;u++)(n=o[u])in c||"Z"===n||"Y"===n?(0!==a.length&&(e=parseInt(a.join(""),d)*s+h,i.push(e),h=e),a="Z"===n?(s=-1,[]):"Y"===n?(s=1,[]):[n]):a.push(l[n]);return i.push(parseInt(a.join(""),d)*s+h),i}function e(t){return[a,function(t){for(var n,e=[],i=t.length,o=0;o<i;o++)n=t[o],e.push(r(n.x)),e.push(r(n.y));return e.join("_")}(t)]}function i(t,n,e){"string"==typeof t&&(t.substring(0,a.length).toLowerCase()===a&&(t=t.substring(a.length+1)),e(function(t){for(var n=[],e=t.split("_"),i=e.length/2,o=0;o<i;o++)n.push({x:s(e[2*o]),y:s(e[2*o+1])});return n}(t)))}var o,a="image/jsignature;base30";(o=(o=g).fn.jSignature)("addPlugin","export","base30",e),o("addPlugin","export",a,e),o("addPlugin","import","base30",i),o("addPlugin","import",a,i)}(),function(){"use strict";function s(t,n){this.x=t,this.y=n,this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)},this._length=null,this.getLength=function(){return this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))),this._length};function i(t){return Math.round(t/Math.abs(t))}this.resizeTo=function(t){var n,e;return 0===this.x&&0===this.y?this._length=0:0===this.x?(this._length=t,this.y=t*i(this.y)):0===this.y?(this._length=t,this.x=t*i(this.x)):(e=(e=Math.abs(this.y/this.x))*(n=Math.sqrt(Math.pow(t,2)/(1+Math.pow(e,2)))),this._length=t,this.x=n*i(this.x),this.y=e*i(this.y)),this},this.angleTo=function(t){var n=this.getLength()*t.getLength();return 0==n?0:Math.acos(Math.min(Math.max((this.x*t.x+this.y*t.y)/n,-1),1))/Math.PI}}function a(t,n){this.x=t,this.y=n,this.getVectorToCoordinates=function(t,n){return new s(t-this.x,n-this.y)},this.getVectorFromCoordinates=function(t,n){return this.getVectorToCoordinates(t,n).reverse()},this.getVectorToPoint=function(t){return new s(t.x-this.x,t.y-this.y)},this.getVectorFromPoint=function(t){return this.getVectorToPoint(t).reverse()}}function h(t,n){n=Math.pow(10,n);return Math.round(t*n)/n}function v(t,n,e){for(var i=["M",h(t.x[0]-n,2),h(t.y[0]-e,2)],o=1,r=t.x.length-1;o<r;o++)i.push.apply(i,function(t,n,e){n+=1;var i=new a(t.x[n-1],t.y[n-1]),o=new a(t.x[n],t.y[n]),r=i.getVectorToPoint(o),o=new a(t.x[n-2],t.y[n-2]);if((i=o.getVectorToPoint(i)).getLength()>e){e=2<n?new a(t.x[n-3],t.y[n-3]).getVectorToPoint(o):new s(0,0);t=.35*i.getLength(),n=i.angleTo(e.reverse()),o=r.angleTo(i.reverse()),n=new s(e.x+i.x,e.y+i.y).resizeTo(Math.max(.05,n)*t),t=new s(i.x+r.x,i.y+r.y).reverse().resizeTo(Math.max(.05,o)*t),t=new s(i.x+t.x,i.y+t.y);return["c",h(n.x,2),h(n.y,2),h(t.x,2),h(t.y,2),h(i.x,2),h(i.y,2)]}return["l",h(i.x,2),h(i.y,2)]}(t,o,1));return 0<r?i.push.apply(i,function(t,n){var e=t.x.length-1,i=new a(t.x[e],t.y[e]),o=new a(t.x[e-1],t.y[e-1]),i=o.getVectorToPoint(i);if(1<e&&i.getLength()>n){t=new a(t.x[e-2],t.y[e-2]).getVectorToPoint(o),e=i.angleTo(t.reverse()),o=.35*i.getLength(),o=new s(t.x+i.x,t.y+i.y).resizeTo(Math.max(.05,e)*o);return["c",h(o.x,2),h(o.y,2),h(i.x,2),h(i.y,2),h(i.x,2),h(i.y,2)]}return["l",h(i.x,2),h(i.y,2)]}(t,o)):0==r&&i.push.apply(i,["l",1,1]),i.join(" ")}function e(t,n){var e,i,o,r,s,a=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],h=t.length,u=[],c=[],l=0,d=0,g=0,p=0,f=[];if(0!==h){for(e=0;e<h;e++)i=function(t){for(var n=[],e={x:[],y:[]},i=0,o=t.x.length;i<o;i++)n.push({x:t.x[i],y:t.y[i]});for(i=0,o=(n=simplify(n,.7,!0)).length;i<o;i++)e.x.push(n[i].x),e.y.push(n[i].y);return e}(t[e]),f.push(i),u=u.concat(i.x),c=c.concat(i.y);o=Math.min.apply(null,u)-1,r=Math.max.apply(null,u)+1,g=o<0?0:o,p=(s=Math.min.apply(null,c)-1)<0?0:s,l=r-o,d=Math.max.apply(null,c)+1-s}for(a.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+l.toString()+'" height="'+d.toString()+'">'),e=0,h=f.length;e<h;e++)i=f[e],a.push("<path "+function(t){for(var n=[],e=[["fill",void 0,"none"],["stroke","color","#000000"],["stroke-width","lineWidth",2],["stroke-linecap",void 0,"round"],["stroke-linejoin",void 0,"round"]],i=e.length-1;0<=i;i--){var o=e[i][0],r=e[i][1],s=e[i][2];n.push(o+'="'+(r in t&&t[r]?t[r]:s)+'"')}return n.join(" ")}(n)+' d="'+v(i,g,p)+'"/>');return a.push("</svg>"),a.join("")}var i;window.simplify=function(t,n,e){n=void 0!==n?n*n:1;return e||(t=function(t,n){for(var e,i,o,r,s=t.length,a=t[0],h=[a],u=1;u<s;u++)e=t[u],o=a,r=void 0,r=(i=e).x-o.x,o=i.y-o.y,n<r*r+o*o&&(h.push(e),a=e);return a!==e&&h.push(e),h}(t,n)),t=function(t,n){var e,i,o,r,s,a,h,u,c,l,d=t.length,g=new(typeof Uint8Array!=void 0+""?Uint8Array:Array)(d),p=0,f=d-1,v=[],y=[],x=[];for(g[p]=g[f]=1;f;){for(i=0,e=p+1;e<f;e++)r=t[e],s=t[p],a=t[f],l=c=u=h=void 0,h=s.x,u=s.y,c=a.x-h,l=a.y-u,0===c&&0===l||(1<(s=((r.x-h)*c+(r.y-u)*l)/(c*c+l*l))?(h=a.x,u=a.y):0<s&&(h+=c*s,u+=l*s)),i<(l=(c=r.x-h)*c+(l=r.y-u)*l)&&(o=e,i=l);n<i&&(g[o]=1,v.push(p),y.push(o),v.push(o),y.push(f)),p=v.pop(),f=y.pop()}for(e=0;e<d;e++)g[e]&&x.push(t[e]);return x}(t,n)},"function"!=typeof i&&(i=function(t){for(var n,e,i,o,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),s=0,a=0,h="",u=[];n=(o=t.charCodeAt(s++)<<16|t.charCodeAt(s++)<<8|t.charCodeAt(s++))>>18&63,e=o>>12&63,i=o>>6&63,o=63&o,u[a++]=r[n]+r[e]+r[i]+r[o],s<t.length;);h=u.join("");var c=t.length%3;return(c?h.slice(0,c-3):h)+"===".slice(c||3)});var o="image/svg+xml";function t(t,n){return[o,e(t,n)]}var n,r="image/svg+xml;base64";function u(t,n){return[r,i(e(t,n))]}if(void 0===g)throw new Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");(n=(n=g).fn.jSignature)("addPlugin","export","svg",t),n("addPlugin","export",o,t),n("addPlugin","export","svgbase64",u),n("addPlugin","export",r,u)}(),g.fn.jSignature("addPlugin","instance","showUndoButton",t)});